<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hochzeit Cathrin & Christoph</title>
    <link rel="icon" type="image/x-icon" href="public/favicon.ico">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant:wght@400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom styles -->
    <link rel="stylesheet" href="src/styles.css">
    <style>
        :root {
            /* Schloss-inspired palette: cream, pine green, brick, muted gold */
            --cream-50: #f7f3ec;
            --cream-100: #f0eae0;
            --cream-200: #e8e0d3;
            --pine-800: #25463f;
            --pine-900: #1b3832;
            --pine-950: #122723;
            --brick-500: #9e5744;
            --gold-400: #c8a96b;
            --ink-900: #0f1715;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            color: #1f2a27;
            background:
                radial-gradient(1100px 600px at 15% 15%, rgba(200,169,107,0.10), transparent),
                radial-gradient(1000px 600px at 85% 10%, rgba(37,70,63,0.10), transparent),
                linear-gradient(180deg, var(--cream-50) 0%, var(--cream-100) 50%, var(--cream-50) 100%);
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Cormorant', serif;
            font-weight: 600;
            letter-spacing: 0.01em;
            color: var(--pine-900);
        }

        /* Accents and theme helpers */
        .jungle-accent { /* repurposed to a refined muted-gold accent */
            color: var(--gold-400);
            text-shadow: 0 0 14px rgba(200,169,107,0.25);
        }
        .gradient-bg {
            background: linear-gradient(135deg, var(--pine-900) 0%, var(--pine-950) 100%);
        }
        .glass {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.35));
            border: 1px solid rgba(27,56,50,0.15);
            box-shadow: 0 12px 40px rgba(27,56,50,0.12);
        }
        .btn-emerald {
            background: linear-gradient(135deg, var(--pine-900), var(--brick-500));
            color: #fff;
            transition: transform .25s ease, box-shadow .25s ease, filter .25s ease;
            box-shadow: 0 12px 26px rgba(27,56,50,0.25);
        }
        .btn-emerald:hover { transform: translateY(-3px); box-shadow: 0 18px 44px rgba(27,56,50,0.35); filter: brightness(1.02); }
        .soft-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(27,56,50,0.18), transparent);
        }

        /* Section reveals */
        .section-fade-in { opacity: 0; transform: translateY(26px); transition: all .7s cubic-bezier(0.4, 0, 0.2, 1); }
        .section-fade-in.visible { opacity: 1; transform: translateY(0); }

        /* Password screen (no ghost, refined) */
        .password-screen {
            background:
                radial-gradient(900px 460px at 15% 20%, rgba(37,70,63,0.14), transparent),
                radial-gradient(1000px 520px at 85% 20%, rgba(200,169,107,0.12), transparent),
                linear-gradient(135deg, var(--cream-100) 0%, var(--cream-200) 100%);
        }

        /* Hero */
        .hero-wrap { position: relative; overflow: hidden; }
        .banner-layer {
            position: absolute; inset: 0;
            width: 100%; height: 100%;
            opacity: 0; visibility: hidden;
            transition: opacity 1.2s ease, visibility 0s linear 1.2s;
            object-fit: cover; object-position: center;
            filter: saturate(0.92) contrast(1.02);
        }
        .banner-layer.is-active {
            opacity: 1; visibility: visible; transition: opacity 1.2s ease, visibility 0s;
        }
        .banner-overlay {
            position: absolute; inset: 0;
            background: linear-gradient(135deg, rgba(247,243,236,0.86), rgba(240,234,224,0.82));
            backdrop-filter: blur(2px);
        }
        .hero-gradient-bottom {
            position: absolute; inset-inline: 0; bottom: 0; height: 38%;
            background: linear-gradient(to top, rgba(247,243,236,0.95), rgba(247,243,236,0));
            pointer-events: none;
        }

        /* Scroll hint */
        .scroll-indicator { animation: floatY 2.6s ease-in-out infinite; opacity: .8; color: var(--pine-800); }
        @keyframes floatY { 0%, 100% { transform: translateY(0) } 50% { transform: translateY(8px) } }

        @media (prefers-reduced-motion: reduce) {
            .section-fade-in, .banner-layer { transition: none !important; }
            .scroll-indicator { animation: none !important; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Password Protection Screen -->
    <div id="passwordScreen" class="password-screen fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="text-center max-w-md w-full">
            <div class="mb-6">
                <h1 class="text-3xl md:text-4xl font-bold mb-2">Moini!</h1>
            </div>
            <div class="card-elegant glass rounded-2xl p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Passwort? 🦧</h3>
                <input 
                    type="password" 
                    id="passwordInput" 
                    placeholder="Passwort eingeben..."
                    class="w-full px-4 py-3 rounded-lg bg-white text-gray-800 outline-none focus:ring-2 focus:ring-[rgba(27,56,50,0.35)] text-center text-lg mb-4"
                    autocomplete="off"
                >
                <button 
                    id="loginButton"
                    class="btn-primary btn-emerald w-full py-3 rounded-xl font-semibold"
                >
                    Öffnen
                </button>
            </div>
        </div>
    </div>

    <!-- Main Website Content (Hidden until password is correct) -->
    <div id="mainContent" class="hidden">
        <!-- Top Navigation -->
        <header class="fixed top-0 inset-x-0 z-30 px-4 py-3">
            <div class="max-w-6xl mx-auto glass rounded-2xl px-5 py-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl font-bold" style="color: var(--pine-900);">C&C</span>
                        <span class="hidden sm:inline text-[color:rgba(27,56,50,0.75)]">06. Juni 2026 · Schloss Bredeneek</span>
                    </div>
                    
                    <!-- Mobile menu button -->
                    <button id="mobileMenuButton" class="md:hidden p-2 text-[color:rgba(27,56,50,0.8)] hover:text-[color:rgba(27,56,50,1)] transition">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>

                    <!-- Desktop navigation -->
                    <nav class="hidden md:flex items-center gap-6 text-[color:rgba(27,56,50,0.8)] font-medium">
                        <a href="#musik" class="hover:text-[color:rgba(27,56,50,1)] transition">Musik</a>
                        <a href="#location" class="hover:text-[color:rgba(27,56,50,1)] transition">Location</a>
                        <a href="#rsvp" class="hover:text-[color:rgba(27,56,50,1)] transition">RSVP</a>
                        <a href="#game" class="hover:text-[color:rgba(27,56,50,1)] transition">Game</a>
                    </nav>
                </div>

                <!-- Mobile navigation (hidden by default) -->
                <nav id="mobileMenu" class="hidden md:hidden pt-4 mt-4 border-t border-[rgba(27,56,50,0.1)]">
                    <div class="flex flex-col gap-4 text-[color:rgba(27,56,50,0.8)] font-medium">
                        <a href="#musik" class="hover:text-[color:rgba(27,56,50,1)] transition py-2">Musik</a>
                        <a href="#location" class="hover:text-[color:rgba(27,56,50,1)] transition py-2">Location</a>
                        <a href="#rsvp" class="hover:text-[color:rgba(27,56,50,1)] transition py-2">RSVP</a>
                        <a href="#game" class="hover:text-[color:rgba(27,56,50,1)] transition py-2">Game</a>
                    </div>
                </nav>
            </div>
        </header>

        <!-- Hero Banner with Sequential Fade (no overlap) -->
        <section class="hero-wrap relative min-h-[80vh] pt-24 md:pt-28">
            <div class="absolute inset-0" style="z-index:0;">
                <!-- First banner image as real <img> for more reliable loading -->
                <img id="bannerImage1" class="banner-layer is-active"
                     src="./public/5768B774-B183-4E5F-AC98-D7E15DFF6A5B_1_105_c.jpeg"
                     alt=""
                     fetchpriority="high"
                     decoding="async"
                     onerror="this.style.display='none';"
                />
                <!-- Second banner image -->
                <img id="bannerImage2" class="banner-layer"
                     src="./public/87D57C71-45DA-44B5-ACC7-36D3FD9A57BD_1_105_c.jpeg"
                     alt=""
                     decoding="async"
                     onerror="this.style.display='none';"
                />
                <!-- Overlay for readability -->
                <div class="banner-overlay"></div>
                <div class="hero-gradient-bottom"></div>
            </div>

            <div class="relative z-10 max-w-6xl mx-auto px-4 text-center">
                <div class="mb-8 section-fade-in">
                    <h1 class="text-5xl md:text-7xl lg:text-8xl font-bold drop-shadow mb-6 leading-tight" style="color: var(--pine-900);">
                        Cathrin<br>&<br>Christoph
                    </h1>
                </div>
                <div class="text-2xl md:text-3xl jungle-accent mb-6 drop-shadow section-fade-in">
                    <p class="font-light" style="color: var(--pine-800); text-shadow: none;">machen Party!</p>
                </div>
                <div class="text-xl md:text-2xl mb-12 drop-shadow section-fade-in" style="color: var(--pine-800); text-shadow: none;">
                    <p class="font-semibold">am 06. Juni 2026</p>
                    <p class="font-light">in Schloss Bredeneek</p>
                </div>

                <div class="flex items-center justify-center gap-2 scroll-indicator">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M12 5v14m0 0l-5-5m5 5l5-5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    <span class="text-sm">Scroll</span>
                </div>
            </div>
        </section>

        <!-- Musik / Spotify Section -->
        <section id="musik" class="relative py-20 px-4">
            <div class="absolute inset-0 -z-10 opacity-[0.18]"
                 style="background: radial-gradient(900px 500px at 10% 10%, rgba(27,56,50,0.25), transparent),
                                 radial-gradient(800px 480px at 90% 20%, rgba(200,169,107,0.35), transparent);">
            </div>
            <div class="max-w-4xl mx-auto text-center section-fade-in">
                <div class="glass rounded-3xl p-4 md:p-6">
                    <div class="rounded-2xl overflow-hidden shadow-2xl">
                        <iframe 
                            id="spotifyPlayer"
                            style="border:0"
                            src="" 
                            width="100%" 
                            height="380" 
                            frameborder="0" 
                            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
                            loading="lazy">
                        </iframe>
                    </div>
                </div>
            </div>
        </section>

        <!-- RSVP Section -->
        <section id="rsvp" class="py-20 px-4 gradient-bg">
            <div class="max-w-4xl mx-auto text-center section-fade-in">
                <h2 class="text-4xl md:text-5xl font-bold text-white mb-6">💌 RSVP</h2>
                <p class="text-lg md:text-xl text-white/80 mb-10 max-w-2xl mx-auto">
                    Bitte gib Bescheid, ob du dabei bist und wie viele Dates du mitbringst
                </p>
                
                <a 
                    id="rsvpButton"
                    href="#" 
                    target="_blank" 
                    rel="noopener noreferrer"
                    class="btn-emerald inline-block font-bold py-4 px-10 rounded-full text-lg md:text-xl"
                >
                    Jetzt antworten →
                </a>

                <div class="mt-10 soft-divider"></div>
                <p class="text-white/70 mt-6 text-sm">
                    Wir freuen uns darauf mit dir zu feiern!
                </p>
            </div>
        </section>

        <!-- Location Section -->
        <section id="location" class="relative py-20 px-4">
            <div class="absolute inset-0 -z-10 opacity-[0.18]"
                 style="background: radial-gradient(900px 500px at 90% 10%, rgba(27,56,50,0.25), transparent),
                                 radial-gradient(800px 480px at 10% 20%, rgba(200,169,107,0.35), transparent);">
            </div>
            <div class="max-w-4xl mx-auto text-center section-fade-in">
                <h2 class="text-4xl md:text-5xl font-bold mb-8" style="color: var(--pine-900);">📍 Location</h2>
                <div class="glass rounded-3xl p-4 md:p-6">
                    <div class="rounded-2xl overflow-hidden shadow-2xl" style="min-height: 450px;">
                        <iframe 
                            width="100%" 
                            height="450" 
                            style="border:0;" 
                            loading="lazy" 
                            allowfullscreen 
                            referrerpolicy="no-referrer-when-downgrade"
                            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2330.299521701236!2d10.297454676788218!3d54.2632786725695!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47b259ecb97e1d39%3A0xcac600d6361be111!2sSchloss%20Bredeneek!5e0!3m2!1sen!2sde!4v1755117031050!5m2!1sen!2sde">
                        </iframe>
                    </div>
                    <div class="mt-6 text-center">
                        <p class="text-lg" style="color: var(--pine-800);">Schloss Bredeneek</p>
                        <a href="https://maps.google.com/?q=Schloss+Bredeneek" 
                           target="_blank" 
                           rel="noopener noreferrer" 
                           class="inline-block mt-3 text-sm btn-emerald py-2 px-6 rounded-full hover:transform hover:-translate-y-1 transition-all duration-300">
                            In Google Maps öffnen →
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Mini Game Section -->
        <section id="game" class="relative py-20 px-4">
            <div class="absolute inset-0 -z-10 opacity-[0.18]"
                 style="background: radial-gradient(900px 500px at 90% 10%, rgba(27,56,50,0.25), transparent),
                                 radial-gradient(800px 480px at 10% 20%, rgba(200,169,107,0.35), transparent);">
            </div>
            <div class="max-w-4xl mx-auto text-center section-fade-in">
                <h2 class="text-4xl md:text-5xl font-bold mb-8" style="color: var(--pine-900);">⚡ Reaktionszeit</h2>
                <div class="glass rounded-3xl p-4 md:p-6">
                    <div class="mb-4">
                        <p class="text-lg mb-4" style="color: var(--pine-800);">Trainiere schonmal für den Startschuss zum Buffet.</p>
                        <button id="startGame" class="btn-emerald py-2 px-6 rounded-full mb-4">
                            Spiel starten
                        </button>
                        <div class="text-lg mb-2" id="instructions">Klicke auf das Licht sobald es grün wird!</div>
                    </div>
                    
                    <div class="relative overflow-hidden rounded-2xl bg-gradient-to-b from-[rgba(255,255,255,0.8)] to-[rgba(255,255,255,0.6)] shadow-2xl flex items-center justify-center" style="height: 400px;">
                        <div id="light" class="w-48 h-48 rounded-full bg-gray-200 transition-colors duration-100 cursor-pointer flex items-center justify-center text-2xl font-bold"></div>
                        
                        <!-- Game Over Modal -->
                        <div id="gameOverModal" class="hidden absolute inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center">
                            <div class="bg-white rounded-xl p-6 max-w-sm w-full mx-4">
                                <h3 class="text-xl font-bold mb-4" style="color: var(--pine-900);">Runde beendet!</h3>
                                <p class="mb-4" style="color: var(--pine-800);">Deine Zeit: <span id="finalScore">0</span>ms</p>
                                <input type="text" 
                                       id="playerName" 
                                       placeholder="Dein Name" 
                                       class="w-full px-4 py-2 rounded-lg mb-4 border border-gray-200 focus:outline-none focus:border-[var(--pine-800)]"
                                       maxlength="20">
                                <button id="saveScore" class="btn-emerald py-2 px-6 rounded-full">
                                    Zeit speichern
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Leaderboard -->
                    <div class="mt-6">
                        <h3 class="text-xl font-bold mb-4" style="color: var(--pine-900);">🏆 Bestenliste</h3>
                        <div id="leaderboard" class="space-y-2">
                            <!-- Leaderboard entries will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="py-12 px-4" style="background: linear-gradient(180deg, var(--cream-100), var(--cream-200)); color: var(--pine-900); text-align: center;">
            <div class="max-w-4xl mx-auto">
                <p class="text-lg mb-2">Cathrin & Christoph</p>
                <p class="text-[color:rgba(27,56,50,0.75)]">06. Juni 2026 • Schloss Bredeneek</p>
                <div class="soft-divider my-6"></div>
                <p class="text-xs text-[color:rgba(27,56,50,0.65)]">Mit viel Liebe ge-vibecoded :)</p>
            </div>
        </footer>
    </div>

    <!-- JavaScript -->
    <script src="config.js"></script>
    <script src="src/main.js"></script>

    <!-- Section reveal on scroll -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const reveal = () => {
                document.querySelectorAll('.section-fade-in').forEach(el => {
                    const rect = el.getBoundingClientRect();
                    if (rect.top < window.innerHeight * 0.85) el.classList.add('visible');
                });
            };
            reveal();
            window.addEventListener('scroll', reveal, { passive: true });
        });
    </script>

    <!-- Set Spotify playlist from config -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const spotifyPlayer = document.getElementById('spotifyPlayer');
            if (spotifyPlayer && window.weddingConfig && window.weddingConfig.spotifyPlaylistUrl) {
                spotifyPlayer.src = window.weddingConfig.spotifyPlaylistUrl;
            }
        });
    </script>

    <!-- Banner sequential fade (no overlap) -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const img1 = document.getElementById('bannerImage1');
            const img2 = document.getElementById('bannerImage2');
            if (!img1 || !img2) return;

            const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

            // Ensure initial states
            img1.classList.add('is-active');
            img2.classList.remove('is-active');

            const waitTransition = (el, prop = 'opacity') =>
                new Promise(resolve => {
                    const onEnd = (e) => {
                        if (e.propertyName === prop) {
                            el.removeEventListener('transitionend', onEnd);
                            resolve();
                        }
                    };
                    el.addEventListener('transitionend', onEnd);
                });

            // If any image fails (display:none from onerror), gracefully avoid cycling to it.
            const isUsable = (el) => !!el && el.style.display !== 'none';

            const startLoop = async () => {
                // Initial hold before first transition (similar to your original timing)
                await new Promise(r => setTimeout(r, 2200));

                // Choose active pair; if one is missing, stop looping (overlay keeps hero readable).
                if (!isUsable(img1) && !isUsable(img2)) return;
                if (!isUsable(img1) && isUsable(img2)) { img2.classList.add('is-active'); return; }
                if (isUsable(img1) && !isUsable(img2)) { img1.classList.add('is-active'); return; }

                let current = img1, next = img2;

                while (true) {
                    await new Promise(r => setTimeout(r, 3800));
                    current.classList.remove('is-active');
                    await waitTransition(current);
                    await new Promise(r => setTimeout(r, 120)); // gap to avoid overlap
                    next.classList.add('is-active');
                    await waitTransition(next);

                    const tmp = current; current = next; next = tmp;
                    if (prefersReduced) break; // single switch for reduced motion
                }
            };

            startLoop();
        });
    </script>

    <!-- Mobile menu functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuButton = document.getElementById('mobileMenuButton');
            const mobileMenu = document.getElementById('mobileMenu');
            let isMenuOpen = false;

            function toggleMenu(event) {
                // Prevent event from bubbling up
                event.stopPropagation();
                
                isMenuOpen = !isMenuOpen;
                mobileMenu.classList.toggle('hidden');
                
                // Toggle menu button appearance
                const menuIcon = mobileMenuButton.querySelector('svg');
                if (isMenuOpen) {
                    menuIcon.innerHTML = `
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    `;
                } else {
                    menuIcon.innerHTML = `
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    `;
                }
                
                // Update aria-expanded state
                mobileMenuButton.setAttribute('aria-expanded', isMenuOpen);
            }

            // Toggle menu on button click
            mobileMenuButton.addEventListener('click', toggleMenu);

            // Close menu when clicking a link
            document.querySelectorAll('#mobileMenu a').forEach(link => {
                link.addEventListener('click', () => {
                    if (isMenuOpen) toggleMenu(new Event('click'));
                });
            });

            // Close menu when clicking outside
            document.addEventListener('click', (e) => {
                if (isMenuOpen && !e.target.closest('.glass')) {
                    toggleMenu(e);
                }
            });

            // Stop click propagation on the menu itself
            mobileMenu.addEventListener('click', (e) => {
                e.stopPropagation();
            });
        });
    </script>

    <!-- Reaction Time Game -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startButton = document.getElementById('startGame');
            const gameOverModal = document.getElementById('gameOverModal');
            const finalScoreDisplay = document.getElementById('finalScore');
            const saveScoreButton = document.getElementById('saveScore');
            const playerNameInput = document.getElementById('playerName');
            const leaderboardDiv = document.getElementById('leaderboard');
            const light = document.getElementById('light');
            const instructions = document.getElementById('instructions');

            let game = {
                isActive: false,
                startTime: null,
                waitTimeout: null,
                reactionTime: null,
                isWaiting: false
            };

            // Load leaderboard from server
            async function fetchLeaderboard() {
                try {
                    console.log('Fetching leaderboard...');
                    const response = await fetch('/.netlify/functions/leaderboard');
                    console.log('Leaderboard response:', response);
                    const leaderboard = await response.json();
                    console.log('Leaderboard data:', leaderboard);
                    updateLeaderboardDisplay(leaderboard);
                } catch (error) {
                    console.error('Error fetching leaderboard:', error);
                }
            }
            
            function updateLeaderboardDisplay(leaderboard = []) {
                leaderboardDiv.innerHTML = leaderboard
                    .map((entry, index) => `
                        <div class="flex items-center justify-between py-2 px-4 ${index === 0 ? 'bg-[rgba(200,169,107,0.2)]' : 'bg-[rgba(27,56,50,0.05)]'} rounded-lg">
                            <span class="font-medium">${entry.name}</span>
                            <span>${entry.score}ms</span>
                        </div>
                    `)
                    .join('');
            }
            fetchLeaderboard();

            function setLightState(state) {
                switch(state) {
                    case 'waiting':
                        light.style.backgroundColor = '#ef4444'; // Red
                        light.textContent = 'Warten...';
                        break;
                    case 'ready':
                        light.style.backgroundColor = '#22c55e'; // Green
                        light.textContent = 'JETZT!';
                        break;
                    case 'idle':
                        light.style.backgroundColor = '#d1d5db'; // Gray
                        light.textContent = '';
                        break;
                    case 'early':
                        light.style.backgroundColor = '#eab308'; // Yellow
                        light.textContent = 'Zu früh!';
                        break;
                }
            }

            function startGame() {
                game.isActive = true;
                game.isWaiting = true;
                startButton.disabled = true;
                setLightState('waiting');
                instructions.textContent = 'Warte auf grün...';
                
                // Random wait between 1 and 10 seconds
                const waitTime = Math.random() * 9000 + 1000;
                game.waitTimeout = setTimeout(() => {
                    if (game.isActive) {
                        game.startTime = Date.now();
                        game.isWaiting = false;
                        setLightState('ready');
                        instructions.textContent = 'KLICK!';
                    }
                }, waitTime);
            }

            function handleClick() {
                if (!game.isActive) return;
                
                if (game.isWaiting) {
                    // Clicked too early
                    clearTimeout(game.waitTimeout);
                    game.isActive = false;
                    setLightState('early');
                    instructions.textContent = 'Zu früh geklickt! Versuche es noch mal.';
                    startButton.disabled = false;
                    return;
                }

                // Valid click after light turned green
                game.reactionTime = Date.now() - game.startTime;
                game.isActive = false;
                endGame();
            }

            function endGame() {
                finalScoreDisplay.textContent = game.reactionTime;
                gameOverModal.classList.remove('hidden');
                setLightState('idle');
                instructions.textContent = 'Klicke auf das Licht sobald es grün wird!';
                startButton.disabled = false;
            }

            async function saveScore() {
                const name = playerNameInput.value.trim() || 'Anonym';
                try {
                    console.log('Saving score:', { name, score: game.reactionTime });
                    const response = await fetch('/.netlify/functions/leaderboard', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            name,
                            score: game.reactionTime
                        })
                    });
                    console.log('Save score response:', response);
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`HTTP error! status: ${response.status}, body: ${errorText}`);
                    }
                    const updatedLeaderboard = await response.json();
                    console.log('Updated leaderboard:', updatedLeaderboard);
                    updateLeaderboardDisplay(updatedLeaderboard);
                    gameOverModal.classList.add('hidden');
                    playerNameInput.value = '';
                } catch (error) {
                    console.error('Error saving score:', error);
                    alert('Fehler beim Speichern des Scores. Bitte versuche es später noch einmal.');
                }
            }

            light.addEventListener('click', handleClick);
            startButton.addEventListener('click', startGame);
            saveScoreButton.addEventListener('click', saveScore);
        });
    </script>

    <!-- Debug script to check if everything loaded -->
    <script>
        console.log('HTML loaded');
        console.log('Config loaded:', typeof window.weddingConfig);
        console.log('Main JS loaded:', typeof checkPassword);
        document.addEventListener('DOMContentLoaded', function() {
            const debugInfo = document.getElementById('debugInfo');
            if (debugInfo) {
                debugInfo.textContent = `Debug: Config=${typeof window.weddingConfig}, checkPassword=${typeof checkPassword}`;
            }
        });
    </script>
</body>
</html>